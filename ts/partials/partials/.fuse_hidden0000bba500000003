interface shutterstock {
	color?: string;
	image_type?: string[];
	orientation?: string;
	query?: string;
	sort?: string;
	page?: string;
}

import { _view } from './view';
import { debug_xhr } from './debug';

export class Shutterstock {
	api: string;
	xhr;
	active;
	counter;

	constructor() {
		this.api = 'https://api.shutterstock.com/v2/images/search';
		this.active = false;
		this.counter = 0;
	}

	search(filter: shutterstock) {
		this.xhr = $.ajax({
			url: this.api,
			data: filter,
			headers: this.authorization()
		});

		if (!this.active) {
			this.active = true;

			this.xhr.done((data) => {
				if (data['data']) {
					let resources = [];

					for (let i = 0; i < data.data.length; i++) {
						let resource = data.data[i];

						resources.push({
							id: resource.id,
							orientation: resource.aspect > 1 ? 'landscape' : (resource.aspect == 1 ? '' : 'portrait'),
							ratio: (resource.assets.preview.height / resource.assets.preview.width) * 100,
							thumbnail: resource.assets.preview.url, 
							type: resource.image_type,
							media: resource.media_type,
							width: resource.assets.preview.width,
							height: resource.assets.preview.height
						});
					}

					_view.print({
						views: ['shutterstock'],
						data: resources
					});

					debug_xhr(this.xhr);

					this.active = false;
				}	
			});	

			this.xhr.error((data) => {
				console.error('Error: ', data);
				
				this.active = false;
			});
		}
	}

	private authorization() {
		let id = '8b227039d20707660c5b';
		let secret = '59529da77eb181bbf019964cf882f0e8e94c9e01';

		return {
			Authorization: 'Basic ' + window.btoa(id + ':' + secret)
		}
	}
}